<div id="cajaTab">
    <h2>Caja - Gestión de Pagos</h2>
    <div class="caja-legend">
        <div><strong>Leyenda:</strong></div>
        <div class="order-status-badge badge-pendiente">Pendiente</div>
        <div class="order-status-badge badge-en-preparacion">En preparación</div>
        <div class="order-status-badge badge-listo">Listo</div>
    </div>

    <div id="cajaOrdersContainer" class="cola-cocina">
        <p>Cargando pedidos...</p>
    </div>
</div>

<!-- Modal de Pago -->
<div class="modal-overlay" id="paymentModal">
    <div class="modal modal-payment">
        <div class="modal-header">
            <h3>Procesar Pago</h3>
            <button class="modal-close" id="closePaymentModal">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="paymentOrderId">

            <!-- Información del pedido -->
            <div class="payment-order-info">
                <p><strong>Mesa:</strong> <span id="paymentTableNumber"></span></p>
                <p><strong>Total del Pedido:</strong> S/ <span id="paymentOrderTotal"></span></p>
            </div>

            <!-- Selector de tipo de comprobante -->
            <div class="receipt-type-selector">
                <label class="radio-label">
                    <input type="radio" name="receiptType" value="BOLETA" id="receiptTypeBoleta" checked>
                    <span>Boleta</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="receiptType" value="FACTURA" id="receiptTypeFactura">
                    <span>Factura</span>
                </label>
            </div>

            <!-- Campos para Boleta -->
            <div id="boletaFields" class="receipt-fields">
                <div class="form-group">
                    <label for="customerDni">DNI (opcional)</label>
                    <input type="text" id="customerDni" maxlength="8" pattern="\d{8}"
                        placeholder="Ingrese DNI de 8 dígitos">
                    <span class="field-error" id="dniError"></span>
                </div>
                <div class="form-group">
                    <label for="customerName">Nombre del Cliente (opcional)</label>
                    <input type="text" id="customerName" maxlength="120" placeholder="Ingrese nombre del cliente">
                    <span class="field-error" id="nameError"></span>
                </div>
            </div>

            <!-- Campos para Factura -->
            <div id="facturaFields" class="receipt-fields" style="display: none;">
                <div class="form-group">
                    <label for="customerRuc">RUC *</label>
                    <input type="text" id="customerRuc" maxlength="11" pattern="\d{11}"
                        placeholder="Ingrese RUC de 11 dígitos" required>
                    <span class="field-error" id="rucError"></span>
                </div>
                <div class="form-group">
                    <label for="customerRazonSocial">Razón Social *</label>
                    <input type="text" id="customerRazonSocial" maxlength="120" placeholder="Ingrese razón social"
                        required>
                    <span class="field-error" id="razonSocialError"></span>
                </div>
            </div>

            <!-- Campo de Descuento -->
            <div class="form-group">
                <label for="paymentDiscount">Descuento (S/)</label>
                <input type="number" id="paymentDiscount" step="0.01" min="0" value="0" placeholder="0.00">
                <span class="field-error" id="discountError"></span>
            </div>

            <!-- Resumen de Pago -->
            <div class="payment-summary">
                <div class="summary-line">
                    <span>Subtotal (sin IGV):</span>
                    <span>S/ <span id="summarySubtotal">0.00</span></span>
                </div>
                <div class="summary-line">
                    <span>IGV (18%):</span>
                    <span>S/ <span id="summaryIgv">0.00</span></span>
                </div>
                <div class="summary-line">
                    <span>Descuento:</span>
                    <span>S/ <span id="summaryDiscount">0.00</span></span>
                </div>
                <div class="summary-line summary-total">
                    <span><strong>TOTAL:</strong></span>
                    <span><strong>S/ <span id="summaryTotal">0.00</span></strong></span>
                </div>
            </div>

            <!-- Botones -->
            <div style="margin-top:16px; display:flex; gap:8px; justify-content:flex-end;">
                <button class="btn btn-secondary" id="cancelPayment">Cancelar</button>
                <button class="btn btn-primary" id="confirmPayment">Confirmar Pago</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Éxito -->
<div class="modal-overlay" id="paymentSuccessModal">
    <div class="modal modal-success">
        <div class="modal-header">
            <h3>Pago Procesado Exitosamente</h3>
            <button class="modal-close" id="closeSuccessModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="success-icon">✓</div>
            <p class="success-message">El pedido #<span id="successOrderId"></span> ha sido marcado como pagado</p>

            <div class="receipt-info">
                <p><strong>Recibo #<span id="successReceiptId"></span></strong></p>
                <p><strong>Tipo:</strong> <span id="successReceiptType"></span></p>
                <p><strong>Cliente:</strong> <span id="successCustomerName"></span></p>
                <p><strong>Total:</strong> S/ <span id="successTotal"></span></p>
            </div>

            <div style="margin-top:16px; display:flex; gap:8px; justify-content:center;">
                <button class="btn btn-secondary" id="viewReceipt">Ver Recibo</button>
                <button class="btn btn-primary" id="printReceipt">Imprimir</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Cancelación -->
<div class="modal-overlay" id="confirmCancelModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Confirmar Cancelación</h3>
            <button class="modal-close" id="closeCancelModal">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="cancelOrderId">
            <p id="cancelMessage"></p>
            <div style="margin-top:12px; text-align:right; display:flex; gap:8px; justify-content:flex-end;">
                <button class="btn btn-secondary" id="cancelCancelAction">Cancelar</button>
                <button class="btn btn-danger" id="confirmCancelAction">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/caja.js}"></script>